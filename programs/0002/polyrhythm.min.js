function playSoundAsync(e){"use strict";new Audio("sounds/"+e+".mp3").play()}function resetVars(){start=null,nextAt=null,oneFrameCircles=[],queuedCircles=[],beatsLater=1}function togglePlayback(){"use strict";(play=!play)?(beatsLater=1,beatNum=0,document.getElementById("toggle").innerHTML="Stop",start=(new Date).getTime(),nextAt=start,playBeat()):(document.getElementById("toggle").innerHTML="Play",drawBeats())}function playBeat(){"use strict";if(doSubdivisions?((new Date).getTime()-start)%Math.min(6e4/Math.max(beat1,beat2)/bpm):((new Date).getTime()-start)%(6e4*beatsLater/Math.max(beat1,beat2)/bpm),-1===beat1||-1===beat2)return play=!1,void(document.getElementById("toggle").innerHTML="Play");for(beatNum%(beat1*beat2)==0?(playSoundAsync("accent1"),flyLine(0,!1),queueFillCircle(0,0,beat1,10,"red"),queueFillCircle(0,1,beat2,10,"red")):(beatNum%beat1==0&&(playSoundAsync("click1"),queueFillCircle(beatNum/beat2%beat1,1,beat1,10,"green")),beatNum%beat2==0&&(playSoundAsync("click2"),queueFillCircle(beatNum/beat1%beat2,0,beat2,10,"green"))),i=beatNum+1;i<=beat1*beat2+beatNum-beatNum%(beat1*beat2);i++)if(i%beat1==0||i%beat2==0){beatsLater=i-beatNum;break}doSubdivisions?(beatNum+=1,nextAt+=6e4/Math.max(beat1,beat2)/bpm):(beatNum+=beatsLater,nextAt+=6e4*beatsLater/Math.max(beat1,beat2)/bpm),play&&setTimeout(function(){playBeat()},nextAt-(new Date).getTime())}function drawCircle(e,t,a,i){ctx.beginPath(),ctx.arc(1300/a*e+100,100*t+50,i,0,2*Math.PI),ctx.stroke()}function drawFillCircle(e,t,a,i,c){ctx.beginPath(),ctx.arc(1300/a*e+100,100*t+50,i,0,2*Math.PI),ctx.fillStyle=c,ctx.fill(),ctx.stroke()}function initializeAudio(){var e=document.createElement("audio");e.setAttribute("src","sounds/click1.mp3"),e.setAttribute("id","click1"),document.body.appendChild(e),(e=document.createElement("audio")).setAttribute("src","sounds/click2.mp3"),e.setAttribute("id","click2"),document.body.appendChild(e),(e=document.createElement("audio")).setAttribute("src","sounds/accent1.mp3"),e.setAttribute("id","accent1"),document.body.appendChild(e)}function queueFillCircle(e,t,a,i,c){queuedCircles.push([e,t,a,i,c])}function clearCanvas(){ctx.clearRect(0,0,c.width,c.height)}function drawBeats(){for(clearCanvas(),i=0;i<=beat1;i++)drawCircle(i,0,beat1,10);for(i=0;i<=beat2;i++)drawCircle(i,1,beat2,10)}function updateRhythm(){"use strict";var e=document.getElementById("meter1").value,t=document.getElementById("meter2").value;if(e%1==0&&t%1==0&&1<=e&&e<=50&&1<=t&&t<=50)return beat1=e,beat2=t,play=!1,document.getElementById("toggle").innerHTML="Play",void drawBeats();resetVars()}function flyLine(e,t){drawBeats();var a=100+1300/(60*Math.min(beat1,beat2)/bpm)*e;if(a>1400)backAndForth&&flyLine(e,!0);else{for(ctx.beginPath(),ctx.moveTo(a,0),ctx.lineTo(a,200),ctx.stroke(),i=0;i<queuedCircles.length;i++)circle=queuedCircles[i],drawFillCircle(circle[0],circle[1],circle[2],circle[3],circle[4]);for(i=0;i<oneFrameCircles.length;i++)circle=oneFrameCircles[i],drawFillCircle(circle[0],circle[1],circle[2],circle[3],circle[4]);oneFrameCircles=[],oneFrameCircles=queuedCircles,queuedCircles=[],play&&(t?setTimeout(function(){flyLine(e-1/60)},1e3/60):setTimeout(function(){flyLine(e+1/60)},1e3/60))}}function updateBPM(){"use strict";var e=document.getElementById("bpminput").value;1<e&&e<500&&(bpm=e),resetVars()}var beatNum=0,play=!1,beat1=5,beat2=3,bpm=120,c=document.getElementById("beater"),ctx=c.getContext("2d"),backAndForth=!1,start,nextAt,beatsLater,doSubdivisions=!0,queuedCircles=[],oneFrameCircles=[];updateRhythm(),updateBPM(),initializeAudio();
